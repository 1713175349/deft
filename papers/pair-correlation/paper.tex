\documentclass[letterpaper,twocolumn,amsmath,amssymb,pre,aps,10pt]{revtex4-1}
\usepackage{graphicx}% Include figure files
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
\usepackage{color}
\usepackage{subcaption} % provides subfigure

\newcommand{\red}[1]{{\bf \color{red} #1}}
\newcommand{\green}[1]{{\bf \color{green} #1}}
\newcommand{\rr}{\textbf{r}}
\newcommand{\refnote}{\red{[ref]}}

\newcommand{\fixme}[1]{\red{[#1]}}

%\newcommand{\derivation}[1]{#1} % Use this to show all derivations in detail
\newcommand{\derivation}[1]{} % Use this for nice pegagogical paper...
\newcommand{\davidsays}[1]{{\color{red} [\green{David:} \emph{#1}]}}
\newcommand{\jeffsays}[1]{{\color{red} [\green{Jeff:} \emph{#1}]}}

\begin{document}
\title{The Pair Distribution Function of the Inhomogeneous Hard-Sphere
  Fluid}

\author{Paho Lurie-Gregg}
\author{Jeff B. Schulte}
\author{David Roundy}
\affiliation{Department of Physics, Oregon State University, Corvallis, OR 97331}

%\pacs{61.20.Ne, 61.20.Gy, 61.20.Ja}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
  We have developed an approximation for the pair distribution
  function of hard spheres, which is based on the average value of the
  pair distribution function at contact described in
  Section~\ref{sec:contact}.  Our pair distribution function is constructed so
  as to be computable with only single-site convolutions and to
  accurately reproduce the averaged distribution function at contact.
  This results in a functional that is efficient to compute, and
  predicts the pair distribution function as well as the most accurate
  existing analytical approximation.
\end{abstract}

\maketitle

\newcommand\saftlocaldft{}
% The following are papers that use a SAFT-based classical DFT with
% all the terms that should be non-local being non-local.
\newcommand\saftnonlocaldft{}

The standard approach in liquid state theory is to treat a liquid as a
hard-sphere reference fluid with attractive interactions that are
treated perturbatively~\cite{hansen2006theory}.  Recently there have
been considerable advances in the development of classical density
functionals based on the
application of these theoretical approaches to inhomogeneous
densities~\cite{ jain2007modified, gloor2007prediction, gross2009density,
  %felipe2001examination, gloor2002saft,
  %gloor2004accurate, clark2006developing,
  kahl2008modified,
  % yu2002fmt-dft-inhomogeneous-associating,
  %fu2005vapor-liquid-dft, bryk2006density,
  hughes2013classical,
  %segura1998comparison, felipe2001examination,
  %gloor2002saft, gloor2004accurate, fu2005vapor-liquid-dft,
  bryk2006density, clark2006developing,
  kahl2008modified, gross2009density,
  %yu2002fmt-dft-inhomogeneous-associating,
  sundararaman2012computationally, marshall2013density}.  The
perturbation theory treatment of intermolecular interactions relies on
the pair distribution function of the reference fluid:
$g^{(2)}(\rr_1,\rr_2)$.  Unlike the radial distribution function of a
homogeneous fluid, there does not currently exist a tractable form for
the pair distribution function of an inhomogeneous hard-sphere fluid,
suitable for use in constructing a density
functional~\cite{gloor2007prediction, jain2007modified}. \fixme{We need to say what a density functional is}

At its core, thermodynamic perturbation theory---sometimes referred to
as the cluster, or high-temperature expansion---is an expansion of the
free energy in powers of a small parameter, which typically is a
pairwise attractive interaction:
\begin{align}
  F &= F_0 + F_1 + \beta F_2 + \mathcal{O}(\beta^2)
\end{align}
where the terms $F_n$ are corrections to the free energy at order $n$
in the small interaction.  The first and largest term in this
expansion is
\begin{align}
  F_1 &= \tfrac12 \iint g^{(2)}_{HS}(\rr_1,\rr_2)n(\rr_1)n(\rr_2)\Phi(|\rr_1-\rr_2|) d\rr_1d\rr_2
\end{align}
where $g^{(2)}_{HS}(\rr_1,\rr_2)$ is the pair distribution function of
the hard-sphere reference fluid, and $\Phi(r)$ is the pair potential.
In this paper, we will introduce an approximation for the hard-sphere
pair distribution function which is suitable for use in the creation
of classical density functionals based on a cluster expansion.

\section{Theoretical approaches}

The classic (and earliest) approach for computing the pair
distribution function is to use Percus' trick of treating one sphere
as an external field, and using the resultant equilibrium density to
find the pair distribution function~\cite{hansen2006theory}.  This
elegant approach lends itself to DFT \fixme{Define DFT earlier!}, and can be used to compute and
plot the pair distribution function, but requires a full free-energy
minimization \emph{for each position} $\rr_1$ in
$g^{(2)}(\rr_1,\rr_2)$, and hence would be prohibitively expensive as
a tool in constructing a free energy functional.

The canonical inhomogeneous configuration for the hard-sphere
fluid is the system consisting of a hard sphere at a hard wall.  In
1986, Plischke and Henderson solved the pair distribution function of
this system using integral equation theory under the Percus-Yevick
approximation~\cite{plischke1986pair}.  Ten years later,
G{\"o}tzelmann \emph{et al.} found the pair distribution function near
a hard wall using classical DFT by finding the direct correlation
function by taking a functional derivative of the free energy
functional and then solving the Ornstein-Zernicke
equation~\cite{gotzelmann1996structure}.  The approach of solving the
Ornstein-Zernicke equation for an inhomogeneous system is
computationally challenging~\cite{paul2003variational}.

Another inhomogeneous configuration that is of interest is the
test-particle configuration, in which one hard sphere is fixed in the
otherwise homogeneous fluid.  Where the hard-wall is a surface with no
curvature, the test-particle configuration has a surface with
curvature at the molecular length scale.  In this case, the density
gives the pair distribution function---this is just Percus'
trick---and the pair distribution function gives the triplet
distribution function.  The triplet distribution function has been computed
by Gonz\'alez \emph{et al.} using the test-particle approach with
\emph{two} spheres fixed~\cite{gonzalez1999test}.

Lado recently introduced a new and improved efficient algorithm for
implementing integral equation theory for inhomogeneous fluids, which
computes $g^{(2)}(\rr_1,\rr_2)$~\cite{lado2009efficient}.  While this
approach is two orders of magnitude more efficient than previous
implementations, it remains a computationally expensive approach, and
unsuitable for repeated evaluation within a free-energy minimization.
\fixme{When we introduce DFT, we should talk about minimization.}

\section{Approximations to the pair distribution function}
There are few analytic approximations for the inhomogeneous pair
distribution function, which extend the radial distribution function
to inhomogeneous scenarios.  These works differ in what density they
use when evaluating the radial distribution function $g(r,\eta)$.

Several recent works have cited a
mean-density approximation:
\begin{align}
  g^{(2)}(\rr_1,\rr_2) \approx g\left(r_{12}, \frac{\pi\sigma^3}{6}\tfrac12
  (n(\rr_1)+n(\rr_2))\right)
\end{align}
where $g(r,\eta)$ is the radial distribution function as a function of
radius and packing fraction $\eta$, and $\sigma$ is the hard-sphere
diameter~\cite{gloor2007prediction, gross2009density}.  These works
did not however use this approach, which fails dramatically at higher
densities, as the packing fraction found from the mean density exceeds
unity.

Approaches that do not diverge use an average of the density over some
volume. Fischer and Methfessel~\cite{fischer1980born} introduce the
approximation
\begin{align}
  g^{(2)}(\rr_1,\rr_2) \approx g\left(r_{12}, n_3\left(\tfrac12
  (\rr_1+\rr_2)\right)\right)
  \label{eq:fischer}
\end{align}
where $n_3$ is one of the fundamental measures defined in Fundamental
Measure Theory~\cite{rosenfeld1989free}, which is an integral of the
density over a spherical volume:
\begin{align}
  n_3(\rr) = \int n(\rr')\Theta(\tfrac12 \sigma - |\rr-\rr'|) d\rr'
\end{align}
where $\sigma$ is the hard-sphere diameter.  Equation~\ref{eq:fischer}
is computationally awkward, because it relies on the midpoint
$\tfrac12(\rr_1+\rr_2)$.  Moreover, the approach of Fischer and
Methfessel is intended to approximate the pair distribution function only
at contact, when the distance between $\rr_1$ and $\rr_2$ is the hard-sphere
diameter.

For these reasons Sokolowski and Fischer modified this approach to use
averages centered on the two points $\rr_1$ and $\rr_2$:
\begin{align}
  g^{(2)}(\rr_1,\rr_2) \approx g\left(r_{12},
  \tfrac12(\bar{n}(\rr_1)+\bar{n}(\rr_2))\right)
  \label{eq:sokolowski}
\end{align}
where
\begin{align}
  \bar{n}(\rr) = \frac{3}{4\pi (0.8\sigma)^3}\int n(\rr')\Theta(0.8\sigma - |\rr-\rr'|) d\rr'
\end{align}
is the density averaged over a sphere with diameter
$0.8\sigma$~\cite{sokolowski1992role}.  The value 0.8 in this formula
was arrived at by fitting to Monte Carlo simulation.  Although
Eq.~\ref{eq:sokolowski} has the advantages of only involving density
averages at the points at which the pair distribution function is
desired, it cannot be written as a single-site convolution, since the
convolution kernel depends on both points.

\fixme{Add a paragraph here explaining the work of Schulte {\em et
    al.}  In particular, we want to emphasize that we have an accurate
representation for an \emph{average} of the pair distribution function
\emph{at contact}.  Then we can cite this in the ``Our Approach''
section.}

\section{Our approach}
We approximate the pair correlation with the average of two radial
distribution functions, evaluated at the distance between the two
points, that are themselves functions of our published pair
correlation at contact $g_{\sigma}(\rr)$ evaluated at the two
points~\cite{schulte2012using}.
\begin{align}
  g^{(2)}(\rr_1,\rr_2) = \frac{g(|r_{12}|, g_\sigma(\rr_1)) + g(|r_{12}|, g_\sigma(\rr_2))}{2}
\end{align}

In the approaches mentioned above, function forms of radial
distributions (used to approximate pair correlation) were dependent
upon independent variables $\eta$, the density, whether at single
points or averaged over sourrounding volumes.  We can achieve greater
accuracy by using instead a function dependent upon our $g_{\sigma}$,
which holds more information about an inhomogeneous system
then a simple convolution of the density does.  We therefore seek a function form for
our radial distribution that is dependent upon $g_{\sigma}$ and that
will approach the correct solution in the homogeneous limit and also
in the limit of contact distance between the two points.

We construct our function's form in terms of an expansion of powers of
$h_{\sigma} = g_{\sigma}-1$, ensuring that it approaches $g_{\sigma}$
in the contact distance limit, leaving our function with tunable
constant perameters.  We run a simple monte-carlo simulation to
calculate values of the homogeneous radial distribution function at
varying distance perameter $r$.  We then tune our function's constant
parameters by matching our function's results against the monte-carlo
data, using a least squares fit method.  During this process it is
simplest to use an analytic expression for $g_{\sigma}$ in our
function and so we use the well known and very successful Carnahan
Starling equation to calculate $g_{\sigma}$.  This is appropriate
since our published $g_{\sigma}$ approaches the Carnahan Starling
version in the homogeneous limit and it's this limit, along with the
contact limit, that we would like our constructed radial distribution
function to get right.  After this process we have an appropriate
radial distribution function that is dependent only on $r$ and
$g_{\sigma}$.

The function has the form:
\begin{multline}
  g(|\rr|) = 1 + h_{\sigma}e^{-x_0(r-\sigma)} \\+ x_1h_{\sigma}\sin(x_2(r-\sigma))e^{-x_3(r-\sigma)}\\
  -x_4h_{\sigma}^2\sin(x_5(r-\sigma))e^{-x_6(r-\sigma)}
\end{multline}
The finalized form of our pair correlation function is:
\begin{align}
  g^{(2)}(\rr_1,\rr_2) = \frac{g(|r_{12}|, g_\sigma(\rr_1)) + g(|r_{12}|, g_\sigma(\rr_2))}{2}
\end{align}

\begin{figure}
  \centering
  \includegraphics[width=\columnwidth]{figs/ghs-g2}% \\
  %\includegraphics[width=\columnwidth]{figs/ghs-g-ghs}
  \caption{Plot of the radial distribution function, with our fit.}\label{fig:radial-distribution}
\end{figure}

\input{figs/fit-parameters}

\subsection{Separable fit to the radial distribution function}

In contrast to the previous works, which are based on the homogeneous
radial distribution function $g(r,\eta)$ expressed as a function of
distance and packing fraction, we have constructed our separable
approximation for the radial distribution function as $g(r,
g_\sigma)$, which is a function of the radius $r$ and its value at
contact $g_\sigma$.  One can convert between these two representation
using the Carnahan-Starling formula for $g_\sigma(\eta)$
\begin{equation}
  g_\sigma = \frac{1-\tfrac{\eta}{2}}{(1-\eta)^3}.
\end{equation}
The form $g(r, g_\sigma)$ is more convenient for treating the
inhomogeneous case, because we can directly compute the averaged value
of $g_\sigma$ for an inhomogeneous system~\cite{schulte2012using}.

We construct $g(r, g_\sigma)$ to satisfy several constraints.  Naturally,
\begin{equation}
  g(\sigma, g_\sigma) = g_\sigma.
\end{equation}
A second constraint applies to the integral of the total correlation
function
\begin{align}
  1 + n\int h(r)d\rr &= nkT\chi_T \label{eq:total-constraint}
\end{align}
where $h(r) = g(r) - 1$ is the total correlation function.
A final constraint is that the slope of the radial distribution
function at contact is given to a very good approximation by \fixme{fix dimensions below}
\begin{align}
  g'(\sigma) \approx - h_\sigma g_\sigma
\end{align}
where $h_\sigma = g_\sigma - 1$ is the total correlation function.
Under these three constraints, we applied a least-squares fit to
simulation data for the radial distribution function at packing
fractions from 0.05 to 0.4 by steps of 0.05.  Our fitted radial
distribution function is given by
\newcommand\kappaa{\kappa_0}
\newcommand\kappab{\kappa_1}
\newcommand\kappac{\kappa_2}
\begin{multline}
  h(r,g_\sigma) = 1 + h_\sigma e^{-\kappaa z} \\
  + h_\sigma(\kappaa - g_\sigma) ze^{-\kappab z} \\
  + \frac{\frac{(1-\eta)^4}{1+4\eta + 4\eta^2 - 4\eta^3 +
      \eta^4}\frac{1}{n}
    - I_0  -I_1(\kappaa - g_\sigma)}{I_2} z^2e^{-\kappac z}
\end{multline}
\begin{equation}
  I_0 = \frac{4\pi h_\sigma (2 + \sigma \kappaa (2 + \sigma \kappaa))}{\kappaa^3}
  - \frac{4\pi}{3} \sigma^3
\end{equation}
\begin{equation}
  I_1 = \frac{4\pi h_\sigma (6 + \sigma \kappab (4 + \sigma \kappab))}{\kappab^4}
\end{equation}
\begin{equation}
  I_2 = \frac{8\pi (12 + \sigma \kappac (6 + \sigma \kappac))}{\kappac^5}
\end{equation}
\begin{equation}
  z = r - \sigma
\end{equation}
\davidsays{Can someone check the above equations for correctness
  against the python code, in plot-ghs2.py.  We'll want to
  ensure the C++ code agrees with this as well.}
\fixme{Clean up the above equations, if possible.}
This function includes three fitted parameters, $\kappaa$, $\kappab$,
and $\kappac$, which are given in Table~\ref{tab:fit-parameters}.
The fit is displayed in Fig.~\ref{fig:radial-distribution}.  In that
figure, it is apparent that the integral f $h(r)$ from
Eq.~\ref{eq:total-constraint} results in cancelling errors at large
distances.  The maximum error in $g(r)$ at packing fractions up to
0.4 is \maxerr, which occurs at $\eta = \etamaxerr$ and $r =
\rmaxerr$.

\begin{table}
  \begin{align*}
    \kappaa &= \kappazero \\
    \kappab &= \kappaone \\
    \kappac &= \kappatwo
  \end{align*}
  \caption{Fit parameters \fixme{... put them here and format this nicely}\fixme{add dimensions here}}
  \label{tab:fit-parameters}
\end{table}

%% In addition, we know that
%% \begin{align}
%%   1 + n\int\left[g(r)-1\right]d\rr &= nkT\chi_T
%% \end{align}
%% \begin{equation}
%%   \begin{split}
%%     \chi_T  &= -\frac{1}{V}\left(\frac{\partial V}{\partial
%%       p}\right)_T \\
%%     &= - \left(V\left(\frac{\partial p}{\partial
%%       V}\right)_T\right)^{-1}
%%   \end{split}
%% \end{equation}
%% \begin{equation}
%%     p = nkT\frac{1+\eta+\eta^2-\eta^3}{(1-\eta)^3}
%% \end{equation}
%% \begin{equation}
%%     \left(\frac{\partial p}{\partial V}\right)_T = \frac{\partial p}{\partial\eta}\frac{\partial\eta}{\partial V} + \frac{\partial p}{\partial n}\frac{\partial n}{\partial V}
%% \end{equation}
%% \begin{equation}
%%     n = \frac{N}{V}\Longrightarrow \frac{\partial n}{\partial V} = -\frac{N}{V^2} = -\frac{n}{V}
%% \end{equation}
%% \begin{equation}
%%     \eta = \frac{4\pi R^3N}{3V}\Longrightarrow \frac{d\eta}{dV} = -\frac{\eta}{V}
%% \end{equation}
%% \begin{equation}
%%   \begin{split}
%%     \left(\frac{\partial p}{\partial V}\right)_T &= -nkT\frac{\eta}{V}\left[\frac{1 + 2\eta - 3\eta^2}{(1-\eta)^3} + 3\frac{1 + \eta + \eta^2 - \eta^3}{(1-\eta)^4}\right]\\
%%     &\quad  - \frac{nkT}{V}\left[\frac{1+\eta+\eta^2-\eta^3}{(1-\eta)^3}\right]\\
%%     &= -nkT\frac{\eta}{V}\left[\frac{(1+2\eta-3\eta^2)(1-\eta) + 3 + 3\eta + 3\eta^2 - 3\eta^3}{(1-\eta)^4}\right]\\
%%     &\quad  - \frac{nkT}{V}\left[\frac{(1+\eta+\eta^2-\eta^3)(1-\eta)}{(1-\eta)^4}\right]\\
%%     &= -\frac{nkT}{V}\left[\frac{4\eta + 4\eta^2 - 2\eta^3}{(1-\eta)^4} + \frac{1 - 2\eta^3 + \eta^4}{(1-\eta)^4}\right]\\
%%   \end{split}
%% \end{equation}
%% \begin{equation}
%%     nkT\chi_T = \frac{(1-\eta)^4}{1 + 4\eta + 4\eta^2 - 4\eta^3 + \eta^4}
%%   %\int (g(r)-1)d\rr &= \frac{\chi_T}{kT} \\
%%   %&= \eta \eta \cdots \fixme{fill in, double-check}
%% \end{equation}
%% where $\chi_T$ is the isothermal compressibility, for which we use the
%% Carnahan-Starling equation of state.


%% An additional constraint that we use sets the slope of $g(r,
%% g_\sigma)$ at $r=\sigma$.  \fixme{explain this}

%% Given these constraints, we use a functional form of
%% \begin{equation}
%%   g(r,g_\sigma) = 1 + A e^{-a(r-\sigma)}
%%   + B (r-\sigma) e^{-b(r-\sigma)} + C (r-\sigma)^2 e^{-c(r-\sigma)}
%% \end{equation}
%% where $A$, $B$, and $C$ are amplitudes determined by the above
%% constraints, and $a$, $b$, and $c$ are parameters fit to Monte Carlo
%% simulations of the hard-sphere radial distribution function.

\newcommand\paircaption{The pair distribution function near a hard
  wall, with packing fractions of 0.1 and 0.3 and $\rr_1$ in contact with
  the hard wall.  On the left is a 2D plot of $g^{(2)}(\rr_1,\rr_2)$
  as $\rr_2$ varies.  The top half of this figure shows the result of the
  Monte Carlo simulation, while the bottom half shows the result of
  the appproximation developed in this work.  On the right is a plot
  of $g^{(2)}(\rr_1,\rr_2)$ on the path illustrated in the figure to
  the left.  This plot compares the Monte Carlo results (black) with
  those of this work (blue), Sokolowski and Fischer
  (red)~\cite{sokolowski1992role}, and Fischer and Methfessel
  (green)~\cite{fischer1980born}.  The latter is only plotted at
  contact, where it is defined.  }

\section{Results}

\begin{figure*}
  \begin{subfigure}{\textwidth}
    \includegraphics[width=\linewidth]{figs/pair-correlation-pretty-1.pdf}
    \vspace{-0.6cm}
    \caption{Pair distribution function near a hard wall with $\eta = 0.1$.}
    \label{fig:pair-distribution-1}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \includegraphics[width=\linewidth]{figs/pair-correlation-pretty-3.pdf}
    \vspace{-0.6cm}
    \caption{Pair distribution function near a hard wall with $\eta = 0.3$.}
    \label{fig:pair-distribution-3}
  \end{subfigure}
  \caption{ \paircaption \fixme{Do we want to label the y-axis for the
      1d plots? } \davidsays{I think so...}
  }\label{fig:pair-distribution}
\end{figure*}

\subsection{Pair distribution function}

%% \begin{figure}
%%   \includegraphics[width=\columnwidth]{figs/pair-correlation-pretty-2.pdf}
%%   \caption{\paircaption{0.2}}\label{fig:pair-distribution-2}
%% \end{figure}
% \begin{figure}
%   \includegraphics[width=\columnwidth]{figs/pair-correlation-pretty-3.pdf}
%   \caption{\paircaption{0.3}}\label{fig:pair-distribution-3}
% \end{figure}
%% \begin{figure}
%%   \includegraphics[width=\columnwidth]{figs/pair-correlation-pretty-4.pdf}
%%   \caption{\paircaption{0.4}}\label{fig:pair-distribution-4}
%% \end{figure}

We begin by examining the pair distribution function near a hard wall,
with a focus on the case where one of the two spheres is in contact
with the hard wall.  Figure~\ref{fig:pair-distribution-1}a
and~\ref{fig:pair-distribution-3}a compare the results of our
approximate functional with Monte Carlo simulation at packing
fractions of 0.1 and 0.3 respectively.  We see reasonable agreement at
the lower density, with some reduced oscillations at larger distances,
and a flatter angular dependence when the two spheres are in contact.
At the higher density, we see significant structure developing in the
simulation results that is not reflected in our approximation.

Figure~\ref{fig:pair-distribution-1}b
and~\ref{fig:pair-distribution-3}b show the pair distribution function
as plotted along a path illustrated in
Fig.~\ref{fig:pair-distribution-1}a.  These plots compare this work
with Monte Carlo results, as well as the approximations of Sokolowski
and Fischer~\cite{sokolowski1992role} and that of Fischer and
Methfessel~\cite{fischer1980born} at packing fractions of 0.1 and 0.3.
The approach of Fischer and Methfessel is only defined when the two
spheres are in contact, and is therefore only plotted on that segment
of the path.  As an input to both previous approximations we use the
hard sphere radial distribution function found with Monte Carlo
simulation, interpolated as necessary.  We find that both previous
approximations to the pair distribution function predict the
qualtitative angular dependence of the pair distribution function at
contact better than this work.  However, in each case the pair
distribution function has a systematic error at contact---either too
high or too low.  Thus while our approximation is smoother than either
of the existing approaches, its errors will have a tendancy to cancel
when used in a perturbation expansion.  At higher densities, the
approximation of Fischer and Methfessel requires evaluating the radial
distribution function at densities significantly higher than the
freezing density, which poses numerical difficulties when using the
radial distribution function from simulation.  When the two points are
more than a radius away from contact, we find that any of these
approaches gives a reasonable prediction, with our approach
underestimating the oscillations in $g^{(2)}$, as expected based on the
fit in Fig.~\ref{fig:radial-distribution}.

\subsection{Triplet distribution function}

\begin{figure*}
  \includegraphics[width=\textwidth]{figs/triplet-correlation-pretty-contact-3.pdf}\\
  \includegraphics[width=\textwidth]{figs/triplet-correlation-pretty-inbetween-3.pdf}
  \caption{\fixme{Tweak spacing, add a, b, c, etc. The 1d plots still
      have two curves for this work, do we want to remove one?
      \davidsays{I'm not sure, I might be tempted to keep both,
        although if we do we should explain the difference between
        them. (left-right mirror image)}} The triplet distribution function
    $g^{(3)}(\rr_1,\rr_2,\rr_3)$ at packing fraction 0.3, plotted when
    $\rr_1$ and $\rr_2$ are in contact.  The color plot on the left
    shows the triplet distribution function, with white corresponding
    to the contact value of the \emph{pair} distribution function.
    The plot on the right shows the value of $g^{(3)}$ along the path
    shown as a dotted line on the plot to the
    left.}\label{fig:triplet-contact-distribution-3}
\end{figure*}
% \begin{figure}
%   \includegraphics[width=\columnwidth]{figs/triplet-correlation-pretty-contact-4.pdf}
%   \caption{The triplet distribution function
%     $g^{(3)}(\rr_1,\rr_2,\rr_3)$ at packing fraction 0.4, plotted when
%     $\rr_1$ and $\rr_2$ are in contact.  The color plot on the left
%     shows the triplet distribution function, with white corresponding
%     to the contact value of the \emph{pair} distribution function.
%     The plot on the right shows the value of $g^{(3)}$ along the path
%     shown as a dotted line on the plot to the
%     left.}\label{fig:triplet-contact-distribution-4}
% \end{figure}

Just as the radial distribution function of a homogeneous fluid may be
computed from the density of an inhomogeneous one using Percus'
test-particle trick, the triplet distribution function of a
homogeneous system can be computed using an approximation of the pair
distribution for an inhomogeneous fluid, such as we have developed.
\begin{multline}
    g^{(3)}(\rr_1,\rr_2,\rr_3) =\\
    \frac{n_{\textrm{TP}(\rr_1)}(\rr_2)
      n_{\textrm{TP}(\rr_1)}(\rr_3)}{n^2}
    g^{(2)}_{\textrm{TP}(\rr_1)}(\rr_2,\rr_3)
\end{multline}
where $g^{(3)}(\rr_1,\rr_2,\rr_3)$ is the triplet distribution
function of a homogeneous fluid with density $n$, and the
$\textrm{TP}(\rr_1)$ subscript indicates quantities computed for the
inhomogeneous density configuration in which one sphere is fixed at
position $\rr_1$.  This method treats one of the three positions---the
location of the test particle---differently from the others, which
means that a poor approximation to the pair distribution function may
beak the symmetry which is present in the true triplet distribution
function.


% \begin{figure}
%   \includegraphics[width=\columnwidth]{figs/triplet-correlation-pretty-inbetween-3.pdf}
%   \caption{The triplet distribution function
%     $g^{(3)}(\rr_1,\rr_2,\rr_3)$ plotted when $\rr_1$ and $\rr_2$ are
%     separated by the diameter of one sphere.}\label{fig:triplet-inbetween-distribution-3}
% \end{figure}
% \begin{figure}
%   \includegraphics[width=\columnwidth]{figs/triplet-correlation-pretty-inbetween-4.pdf}
%   \caption{The triplet distribution function
%     $g^{(3)}(\rr_1,\rr_2,\rr_3)$ plotted when $\rr_1$ and $\rr_2$ are
%     separated by the diameter of one sphere.}\label{fig:triplet-inbetween-distribution-4}
% \end{figure}

\fixme{The following paragraph needs to be rewritten when we've
  reorganized the figures. (Obviously.)}

Figures~\ref{fig:triplet-contact-distribution-3}-\ref{fig:triplet-inbetween-distribution-4}
compare the triplet distribution function computed using our
approximation to $g^{(2)}$ with results from Monte Carlo simulation.
In each figure, $\rr_1$ and $\rr_2$ are held fixed, while the third
position $\rr_3$ is varied.  The test-particle position in each case
is $\rr_1$, which is on the left-hand side of the figure.  In the
color plot on the left, the first and second spheres are displayed in
grey.  On the bottom half of figures \fixme{b,d,etc?} is the triplet
correlation function as computed using the approximation presented in
this work.  The top half of those figures displays the triplet
correlation function from Monte Carlo.  Figures~\fixme{a,c,e?} show
the triplet distribution function along the paths illustrated in the
corresponding 2D plots.

Figures~\fixme{which} and~\fixme{which} show the triplet distribution
function when two of the positions $\rr_1$ and $\rr_2$ are in contact.
The triplet distribution function predicted by this work is slightly
asymmetric, indicating a failure in thermodynamic consistency.  Once
again, we observe the lack of oscillations at large distances.
Figures~\fixme{which} and~\fixme{which} show the triplet distribution
function when two of the positions $\rr_1$ and $\rr_2$ are spaced so
that the third could just fit between them.  Again, the triplet
distribution function predicted by this work is slightly asymmetric,
and lacks the oscillations seen in the Monte Carlo simulations at
large distances.  In both cases, our agreement with simulation is
comparable to that of previous approximations.

\section{Performance in thermodynamic perturbation theory}

\begin{figure}
  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figs/dadz-3-2.pdf}
    \vspace{-0.8cm}
    \caption{Sticky hard-sphere fluid}\label{fig:dadz-delta}
  \end{subfigure}
  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figs/dadz-square-well-3.pdf}
    \vspace{-0.8cm}
    \caption{Hard-core square well fluid}\label{fig:dadz-square-well}
  \end{subfigure}
  \begin{subfigure}{\columnwidth}
    \includegraphics[width=\columnwidth]{figs/dadz-inverse-sixth-3.pdf}
    \vspace{-0.8cm}
    \caption{Hard-core inverse-sixth fluid}\label{fig:dadz-inverse-sixth}
  \end{subfigure}
  \caption{Plot of $\frac{da_1}{dz}$ near a hard wall.\fixme{Do we
      want y-axis ticks or no? Also, why does the data start at $z =
      0$? \davidsays{I think ticks on the vertical axis aren't needed
        because we are not including the scale (which depends on
        prefactors).  I think data starting at $z=0$ is a result of a
        (poor?) choice of where to define $z=0$.  It's the same
        definition we use in Fig. 2, so I think the two should stay
        consistent...}}}
  \label{fig:dadz}
\end{figure}

A particularly relevant quantitative test of a pair distribution
function is how well it predicts the interaction energy due to a pair
potential.  To this end, we have computed the error in the first term
in a high-temperature perturbation expansion $a_1$ for several pair
potentials.  In order to focus on effects at the interface, we have
defined a position-dependent pair interaction energy as
\begin{align}
  \frac{dF_1}{dz} &=
  \tfrac12 \int g^{(2)}_{HS}(\rr,\rr')n(\rr)n(\rr')\Phi(|\rr-\rr'|)
  d\rr'\, dxdy\label{eq:da1}
\end{align}
which gives the contribution to the mean-field free energy due to
molecules located at position $z$.

We plot in Fig.~\ref{fig:dadz} this quantity for hard-core fluids with
three representative pair potentials near a hard wall.  We have chosen
to illustrate a delta-function ineraction at contact (i.e. ``sticky
hard spheres''), a hard-core square-well fluid, with the length-scale
of interaction taken from the optimal SAFT model for water found by
Clark \emph{et al.}~\cite{clark2006developing}, and a $1/r^6$
power-law attraction.  These pair potentials represent a short-range
interaction, a medium-range discontinuous interaction, and a
long-range smooth interaction.

Figure~\ref{fig:dadz-delta} shows the results for the sticky
hard-sphere fluid.  Our pair distribution function is constructed to
produce this result exactly, provided the averaged pair distribution
function at contact from Ref.~\citenum{schulte2012using} is exact.  As
expected, we see excellent agreement with the Monte Carlo simulation
results, while the approximations of Fischer and Sokolowski each show
deviations near the interface.  Figure~\ref{fig:dadz-square-well}
shows the same curve from Eq.~\ref{eq:da1} for the square-well fluid.
This potential stresses our approximation to the radial distribution
function, since the edge of the attraction occurs at the dip in the
radial distribution function at this density, with poor results for
the bulk fluid.  We see that over these length scales, Sokolowski's
approximation is very accurate.  Finally, in the case of the power-law
attraction both approximations work very well.

\section{Conclusion}

We have introduced and tested an approximation for the pair
distribution function of the inhomogeneous hard-sphere fluid.  Our
approximation is suitable for use in the development of classical
density functionals based constructed using perturbation theory, and
may be computed using exclusively single-center convolutions.  We have
tested this function at a hard wall and near a single fixed hard
sphere, and find that it gives qualitatively reasonable results.
Tests of the pair distribution function in integrals that arise in
thermodynamic perturbation theory suggest that our approximation gives
good results for both short-range and long-range attractions.

\bibliography{paper}% Produces the bibliography via BibTeX.

\end{document}
