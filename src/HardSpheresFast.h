// -*- mode: C++; -*-

#pragma once

#include "Functional.h"

class HardSpheresFast_type : public FunctionalInterface {
public:
  HardSpheresFast_type(double R_arg, double kT_arg) : R(R_arg), kT(kT_arg) { have_analytic_grad = false; }
  double transform(double) const {
    return 0;
  }
  double derive(double) const {
    return 0;
  }

  VectorXd transform(const GridDescription &gd, const VectorXd &x) const {
    assert(&gd); // to avoid an unused parameter error
    assert(&x); // to avoid an unused parameter error
    return kT*((-1/(12.56637061435917*(R*R))*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()) + kT*((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - xShellConvolve(R)(gd, x).cwise().square() + (-yShellConvolve(R)(gd, x).cwise().square() - zShellConvolve(R)(gd, x).cwise().square())).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))) + kT*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))));
  }
  Functional grad(const Functional &, bool) const {
    assert(false);
    return 0;
  }

  void grad(const GridDescription &gd, const VectorXd &x, const VectorXd &ingrad, VectorXd *outgrad, VectorXd *outpgrad) const {
    assert(&gd); // to avoid an unused parameter error
    assert(&x); // to avoid an unused parameter error
    *outgrad += ifft(gd, step(gd, R).cwise()*fft(gd, -(((-1/(12.56637061435917*(R*R))*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(kT*ingrad)).cwise()/(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))))) + ifft(gd, shell(gd, R).cwise()*fft(gd, -1/(12.56637061435917*(R*R))*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log().cwise()*(kT*ingrad)))) + (2*ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square().cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + 2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (ifft(gd, shell(gd, R).cwise()*fft(gd, 3*((xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (ifft(gd, xxshell(gd, R).cwise()*fft(gd, xShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, yyshell(gd, R).cwise()*fft(gd, yShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, zShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (ifft(gd, xyshell(gd, R).cwise()*fft(gd, (xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + yShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (xShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + ifft(gd, yzshell(gd, R).cwise()*fft(gd, (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (zShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + yShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zxshell(gd, R).cwise()*fft(gd, (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + xShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (zShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zxshell(gd, R).cwise()*fft(gd, ((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (ifft(gd, yzshell(gd, R).cwise()*fft(gd, (6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, xyshell(gd, R).cwise()*fft(gd, 6*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, xxshell(gd, R).cwise()*fft(gd, ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (2*ifft(gd, xyshell(gd, R).cwise()*fft(gd, ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (2*ifft(gd, zxshell(gd, R).cwise()*fft(gd, ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (ifft(gd, xxshell(gd, R).cwise()*fft(gd, (ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (2*ifft(gd, xyshell(gd, R).cwise()*fft(gd, ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, yyshell(gd, R).cwise()*fft(gd, ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (2*ifft(gd, yzshell(gd, R).cwise()*fft(gd, ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, (3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (2*ifft(gd, zxshell(gd, R).cwise()*fft(gd, ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (2*ifft(gd, yzshell(gd, R).cwise()*fft(gd, ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, zzshell(gd, R).cwise()*fft(gd, ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zzshell(gd, R).cwise()*fft(gd, (3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, step(gd, R).cwise()*fft(gd, ((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()))) + (ifft(gd, step(gd, R).cwise()*fft(gd, -(((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()))).cwise()/(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))))) + 2*ifft(gd, step(gd, R).cwise()*fft(gd, -((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise()*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log().cwise()*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())))))) - (2*ifft(gd, step(gd, R).cwise()*fft(gd, -((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise()*((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()*((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad))).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()).cwise().square()))))) + 2*ifft(gd, step(gd, R).cwise()*fft(gd, ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise()*(113.0973355292326*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()*((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad))).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()).cwise().square()))))))))))))))))))))))))))))))) - ifft(gd, step(gd, R).cwise()*fft(gd, -(12.56637061435917*R*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - xShellConvolve(R)(gd, x).cwise().square() + (-yShellConvolve(R)(gd, x).cwise().square() - zShellConvolve(R)(gd, x).cwise().square())).cwise()*(kT*ingrad)).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))).cwise().square())))))))));
    if (outpgrad) *outpgrad += ifft(gd, step(gd, R).cwise()*fft(gd, -(((-1/(12.56637061435917*(R*R))*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(kT*ingrad)).cwise()/(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))))) + ifft(gd, shell(gd, R).cwise()*fft(gd, -1/(12.56637061435917*(R*R))*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log().cwise()*(kT*ingrad)))) + (2*ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*-((kT*ingrad).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))))))) + (2*ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + ifft(gd, shell(gd, R).cwise()*fft(gd, ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square().cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + 2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*((3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (ifft(gd, shell(gd, R).cwise()*fft(gd, 3*((xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()).cwise()*-(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (ifft(gd, xxshell(gd, R).cwise()*fft(gd, xShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*xShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, yyshell(gd, R).cwise()*fft(gd, yShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*yShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, zShellConvolve(R)(gd, x).cwise().square().cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))) + (2*zShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (ifft(gd, xyshell(gd, R).cwise()*fft(gd, (xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + yShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (xShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + ifft(gd, yzshell(gd, R).cwise()*fft(gd, (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (zShellConvolve(R)(gd, -(yShellConvolve(R)(gd, x).cwise()*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + yShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zxshell(gd, R).cwise()*fft(gd, (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + xShellConvolve(R)(gd, -(zShellConvolve(R)(gd, x).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (zShellConvolve(R)(gd, -(xShellConvolve(R)(gd, x).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(2*(9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zxshell(gd, R).cwise()*fft(gd, ((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (ifft(gd, yzshell(gd, R).cwise()*fft(gd, (6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, xyshell(gd, R).cwise()*fft(gd, 6*(ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, xxshell(gd, R).cwise()*fft(gd, ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (2*ifft(gd, xyshell(gd, R).cwise()*fft(gd, ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (2*ifft(gd, zxshell(gd, R).cwise()*fft(gd, ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (ifft(gd, xxshell(gd, R).cwise()*fft(gd, (ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (2*ifft(gd, xyshell(gd, R).cwise()*fft(gd, ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, yyshell(gd, R).cwise()*fft(gd, ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (2*ifft(gd, yzshell(gd, R).cwise()*fft(gd, ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, (3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + (2*ifft(gd, zxshell(gd, R).cwise()*fft(gd, ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + (2*ifft(gd, yzshell(gd, R).cwise()*fft(gd, ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))))) + 2*ifft(gd, zzshell(gd, R).cwise()*fft(gd, ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad))))))) + (ifft(gd, zzshell(gd, R).cwise()*fft(gd, (3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(0.5*(-9*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())).cwise()*(kT*ingrad)))))) + ifft(gd, step(gd, R).cwise()*fft(gd, ((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()))) + (ifft(gd, step(gd, R).cwise()*fft(gd, -(((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()))).cwise()/(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))))) + 2*ifft(gd, step(gd, R).cwise()*fft(gd, -((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise()*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log().cwise()*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad)).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square())))))) - (2*ifft(gd, step(gd, R).cwise()*fft(gd, -((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise()*((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()*((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad))).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()).cwise().square()))))) + 2*ifft(gd, step(gd, R).cwise()*fft(gd, ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise()*(113.0973355292326*((VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(((ifft(gd, step(gd, R).cwise()*fft(gd, x)) + (VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square().cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().log()).cwise()*((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise()*ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - (3*ifft(gd, shell(gd, R).cwise()*fft(gd, x))).cwise()*(xShellConvolve(R)(gd, x).cwise().square() + yShellConvolve(R)(gd, x).cwise().square() + zShellConvolve(R)(gd, x).cwise().square()) + 9*(xShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)) + yShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise().square().cwise()*ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)) + 2*((xShellConvolve(R)(gd, x).cwise()*yShellConvolve(R)(gd, x)).cwise()*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)) + (yShellConvolve(R)(gd, x).cwise()*zShellConvolve(R)(gd, x)).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)) + (zShellConvolve(R)(gd, x).cwise()*xShellConvolve(R)(gd, x)).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x))) + -0.5*(((6*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x))).cwise()*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)) + ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise()*(ifft(gd, xxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + (ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, xyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, yyshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square()) + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise()*(3*ifft(gd, zxshell(gd, R).cwise()*fft(gd, x)).cwise().square() + 3*ifft(gd, yzshell(gd, R).cwise()*fft(gd, x)).cwise().square() + ifft(gd, zzshell(gd, R).cwise()*fft(gd, x)).cwise().square())))))).cwise()*(kT*ingrad))).cwise()/((113.0973355292326*ifft(gd, step(gd, R).cwise()*fft(gd, x)).cwise().square()).cwise()*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x))).cwise().square()).cwise().square()))))))))))))))))))))))))))))))) - ifft(gd, step(gd, R).cwise()*fft(gd, -(12.56637061435917*R*(((ifft(gd, shell(gd, R).cwise()*fft(gd, x)).cwise().square() - xShellConvolve(R)(gd, x).cwise().square() + (-yShellConvolve(R)(gd, x).cwise().square() - zShellConvolve(R)(gd, x).cwise().square())).cwise()*(kT*ingrad)).cwise()/(12.56637061435917*R*(VectorXd::Ones(gd.NxNyNz) - ifft(gd, step(gd, R).cwise()*fft(gd, x)))).cwise().square())))))))));
  }

  Expression printme(const Expression &) const {
    return Expression("Can't print optimized Functionals");
  }
private:
  double R;
  double kT;
};

inline Functional HardSpheresFast(double R, double kT) {
  return Functional(new HardSpheresFast_type(R, kT), "HardSpheresFast");
}
